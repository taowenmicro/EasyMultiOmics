% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/rf_network_from_phyloseq.R
\name{rf_network_from_phyloseq}
\alias{rf_network_from_phyloseq}
\title{Random Forest-based Microbial Association Network}
\usage{
rf_network_from_phyloseq(
  ps,
  ntree = 500,
  normalize = TRUE,
  scale.method = c("l1", "softmax", "minmax", "none"),
  n_perm = 100,
  p.threshold = 0.05,
  seed = 123
)
}
\arguments{
\item{ps}{A `phyloseq` object containing OTU/ASV table.}

\item{ntree}{Integer. Number of trees to grow in each Random Forest.
Default is \code{500}.}

\item{normalize}{Logical. Whether to normalize variable importance so that
scores sum to 1 for each model. Default is \code{TRUE}.}

\item{scale.method}{Character. Method used for normalization.
Options: \code{"l1"}, \code{"softmax"}, \code{"minmax"}, \code{"none"}.
Default is \code{"l1"}.}

\item{n_perm}{Integer. Number of permutations for significance testing.
If > 0, permutation-based p-values are computed.
If 0, no permutation test is performed. Default is \code{100}.}

\item{p.threshold}{Numeric. Significance threshold for permutation test.
Edges with p-value < threshold are retained. Default is \code{0.05}.}

\item{seed}{Integer. Random seed for reproducibility. Default is \code{123}.}
}
\value{
A list with two components:
\describe{
  \item{edges}{A data frame of significant associations with columns:
    \code{target}, \code{predictor}, \code{importance}, and (if applicable) \code{pval}.}
  \item{importance_all}{A data frame of all importance values (before significance filtering).}
}
}
\description{
Construct a microbial association network using Random Forests from a
`phyloseq` object. Each taxon (OTU/ASV/species) is iteratively treated as the
response variable, with the remaining taxa as predictors. Variable
importance is extracted from the Random Forest model, normalized such that
the importance scores for all predictors sum to 1, and optionally evaluated
for significance using permutation testing.
}
\details{
For each taxon, a Random Forest model is trained using all other taxa as
predictors. Variable importance scores are extracted using permutation
importance. Importance scores can be normalized by several methods:
\itemize{
  \item \code{"l1"}: Divide by L1 norm (absolute sum), making scores sum to 1.
  \item \code{"softmax"}: Convert to probabilities via softmax.
  \item \code{"minmax"}: Rescale to [0, 1] using min-max normalization.
  \item \code{"none"}: Use raw importance values.
}

When \code{n_perm > 0}, a permutation test is performed by randomly shuffling
the response variable \code{y} and recomputing importance values across
\code{n_perm} iterations. P-values are then computed as the proportion of
null importance values greater than or equal to the observed importance.
}
\examples{
\dontrun{
library(phyloseq)
data("GlobalPatterns")

# Subset to 20 taxa for demonstration
ps_sub <- prune_taxa(taxa_names(GlobalPatterns)[1:20], GlobalPatterns)

res <- rf_network_from_phyloseq(
  ps = ps_sub,
  ntree = 100,
  normalize = TRUE,
  scale.method = "l1",
  n_perm = 10,
  p.threshold = 0.05
)

head(res$edges)
head(res$importance_all)
}

}
\author{
Wen Tao <\email{2018203048@njau.edu.cn}>
}
