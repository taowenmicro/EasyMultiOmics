% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cir_barplot.metm2.R
\name{cir_barplot.metm2}
\alias{cir_barplot.metm2}
\title{Circular dendrogram + tight three concentric stacked-bar rings (separate palettes & legends)}
\usage{
cir_barplot.metm2(
  ps,
  Top = 15,
  dist = "bray",
  cuttree = 3,
  hcluter_method = "complete",
  rank = "Phylum",
  thresholds = c(1, 0.1),
  n_each = c(10, 8, 8),
  xlim_high = NULL,
  xlim_medium = NULL,
  xlim_low = NULL,
  breaks_high = NULL,
  breaks_medium = NULL,
  breaks_low = NULL,
  clip = TRUE,
  ring_pwidth = c(1.2, 1.1, 1.1),
  ring_bar_width = c(0.5, 0.5, 0.5),
  base_offset = 0.9,
  ring_gap = 0,
  axis_pad = 0,
  show_axes = c(FALSE, FALSE, FALSE),
  legend_position = "right"
)
}
\arguments{
\item{ps}{A \code{phyloseq} object.}

\item{Top}{Integer. Number of globally top taxa to keep for binning/plotting. Default: 15.}

\item{dist}{Character. Distance metric passed to \code{phyloseq::distance}. Default: "bray".}

\item{cuttree}{Integer. Number of clusters to cut the dendrogram into. Default: 3.}

\item{hcluter_method}{Character. Hierarchical clustering method. Default: "complete".}

\item{rank}{Character. Taxonomic rank for aggregation (e.g., "Phylum", "Genus"); must exist in \code{tax_table}.}

\item{thresholds}{Numeric length-2 (percent), e.g., \code{c(1, 0.1)} meaning
High (≥ max), Medium [min, max), Low (< min). Order-insensitive.}

\item{n_each}{Integer length-3. Number of representative taxa for \code{c(High, Medium, Low)}.
Default \code{c(10, 8, 8)}.}

\item{xlim_high, xlim_medium, xlim_low}{Numeric length-2 or \code{NULL}. Display ranges (in %) for the three rings.
If \code{NULL}, ranges are automatically determined.}

\item{breaks_high, breaks_medium, breaks_low}{Numeric vectors or \code{NULL}. Tick breaks for the three rings.
If \code{NULL}, breaks are auto-calculated from ranges.}

\item{clip}{Logical. Whether to truncate values outside x-limits (display only). Default: \code{TRUE}.}

\item{ring_pwidth}{Numeric length-3. Radial width of rings \code{c(High, Medium, Low)}. Default \code{c(1.2, 1.1, 1.1)}.}

\item{ring_bar_width}{Numeric length-3. Bar width in each ring. Default \code{c(0.5, 0.5, 0.5)}.}

\item{base_offset}{Numeric. Distance from the tree to the inner ring. Default: 0.9.}

\item{ring_gap}{Numeric. Base gap between adjacent rings. Default: 0.}

\item{axis_pad}{Numeric. Extra padding if a ring shows its axis. Default: 0.}

\item{show_axes}{Logical length-3. Whether to show abundance (x) axis for each ring. Default \code{c(FALSE, FALSE, FALSE)}.}

\item{legend_position}{Character. Legend position for \code{ggplot2}. Default: "right".}
}
\value{
A list with:
\describe{
  \item{plot}{The circular dendrogram with three stacked-bar rings (High → Medium → Low),
              using three distinct palettes and three separate legends.}
  \item{data_high,data_medium,data_low}{Data frames used for the High/Medium/Low rings.}
  \item{selected_taxa}{A list of representative taxa: \code{list(high, medium, low)}.}
  \item{cuts}{A list with thresholds: \code{list(hi_cut, lo_cut)}.}
}
}
\description{
Add **three** stacked-bar rings (High / Medium / Low) outside a circular hierarchical
clustering dendrogram. To create a near “no-gap” appearance by default, ring axes are
turned off and both the inter-ring gap and axis padding are set to 0, while the
tree-to-inner-ring distance (`base_offset`) is kept small.
Each ring uses its **own** fill scale via \strong{ggnewscale::new_scale_fill} and a
dedicated \strong{ggplot2::scale_fill_manual}, yielding **three different palettes and
three separate legends** (High / Medium / Low).
}
\examples{
\dontrun{
library(phyloseq); data(GlobalPatterns)
ps_demo <- prune_samples(sample_sums(GlobalPatterns) > 0, GlobalPatterns)
set.seed(1); ps_demo <- prune_samples(sample(sample_names(ps_demo), 20), ps_demo)

res <- cir_barplot.metm2(
  ps = ps_demo, Top = 20, rank = "Phylum",
  thresholds = c(1, 0.1), n_each = c(10, 8, 8),
  xlim_high = c(0,100), xlim_medium = c(0,20), xlim_low = c(0,5),
  breaks_high = seq(0,100,10), breaks_medium = seq(0,20,5), breaks_low = seq(0,5,1),
  ring_pwidth = c(1.2,1.1,1.1),
  base_offset = 0.9, ring_gap = 0, axis_pad = 0,
  show_axes = c(FALSE, FALSE, FALSE),
  legend_position = "right"
)
print(res$plot)
}

}
\author{
Tao Wen, Peng-Hao Xie
}
